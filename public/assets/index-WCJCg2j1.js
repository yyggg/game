import{e as w,a as V,f as k,h as l,k as i,T as d,s as h,a5 as j,Y as m,X as _,U as F,_ as x,a7 as D,o,j as E,l as L,a8 as b}from"./vue-CwFJaX1P.js";import{j as r,A as N,B as R,_ as $,C as z}from"./index-PFvgZIwd.js";const I=["id"],S={key:0,class:"loading"},U={key:1,class:"captcha-img-box"},X=["src","alt"],Y=["onClick"],A={key:2,class:"captcha-prompt"},M={key:3,class:"captcha-prompt"},P={class:"captcha-refresh-box"},q=["title"],G=w({__name:"index",props:{uuid:{default:""},callback:{type:Function,default:()=>{}},class:{default:""},unset:{type:Boolean,default:!1},error:{default:r.global.t("validate.The correct area is not clicked, please try again!")},success:{default:r.global.t("validate.Verification is successful!")}},emits:["destroy"],setup(p,{emit:u}){D(e=>({"2d849bf4":T.value,"09ba13c8":B.value,b945de4e:t.captcha.width,a313df18:t.captcha.height}));const a=p,t=V({loading:!0,xy:[],tip:"",captcha:{id:"",text:"",base64:"",width:350,height:200}}),f=u,g=()=>{t.loading=!0,N(a.uuid).then(e=>{t.xy=[],t.tip="",t.loading=!1,t.captcha=e.data})},C=e=>{if(t.xy.length<t.captcha.text.length&&(t.xy.push(e.offsetX+","+e.offsetY),t.xy.length==t.captcha.text.length)){const s=[t.xy.join("-"),e.target.width,e.target.height].join(";");R(a.uuid,s,a.unset).then(()=>{t.tip=a.success,setTimeout(()=>{var c;(c=a.callback)==null||c.call(a,s),y()},1500)}).catch(()=>{t.tip=a.error,setTimeout(()=>{g()},1500)})}},v=e=>{t.xy.splice(e,1)},y=()=>{f("destroy")},B=k(()=>(t.captcha.height+200)/2+"px"),T=k(()=>(t.captcha.width+24)/2+"px");return g(),(e,s)=>(o(),l("div",{id:e.uuid},[i("div",{class:x(["ba-click-captcha",a.class])},[t.loading?(o(),l("div",S,d(h(r).global.t("utils.Loading")),1)):(o(),l("div",U,[i("img",{class:"captcha-img",onClick:s[0]||(s[0]=j(c=>C(c),["prevent"])),src:t.captcha.base64,alt:h(r).global.t("validate.Captcha loading failed, please click refresh button")},null,8,X),(o(!0),l(m,null,_(t.xy,(c,n)=>(o(),l("span",{key:n,class:"step",onClick:J=>v(n),style:E(`left:${parseFloat(c.split(",")[0])-13}px;top:${parseFloat(c.split(",")[1])-13}px`)},d(n+1),13,Y))),128))])),t.tip?(o(),l("div",A,d(t.tip),1)):(o(),l("div",M,[F(d(h(r).global.t("validate.Please click"))+" ",1),(o(!0),l(m,null,_(t.captcha.text,(c,n)=>(o(),l("span",{key:n,class:x(t.xy.length>n?"clicaptcha-clicked":"")},d(c),3))),128))])),i("div",P,[s[1]||(s[1]=i("div",{class:"captcha-refresh-line captcha-refresh-line-l"},null,-1)),i("i",{class:"fa fa-refresh captcha-refresh-btn",title:h(r).global.t("Refresh"),onClick:g},null,8,q),s[2]||(s[2]=i("div",{class:"captcha-refresh-line captcha-refresh-line-r"},null,-1))])],2),i("div",{class:"ba-layout-shade",onClick:y})],8,I))}}),H=$(G,[["__scopeId","data-v-bd2d46c3"]]),Q=(p,u,a={})=>{const t=document.createElement("div"),f=L(H,{uuid:p,callback:u,...a,key:z(),onDestroy:()=>{b(null,t)}});b(f,t),document.body.appendChild(t.firstElementChild)};export{Q as c};
