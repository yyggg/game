import{o as p,h as S,e as Y,$ as x,p as I,a as ee,x as oe,m,W as ae,l as n,O as r,k as v,T as d,Z as T,N as g,s as t,U as c,a6 as F,V as w}from"./vue-CwFJaX1P.js";import{F as f}from"./index-CkJ5YQgv.js";import{_ as j,y as le,b as ie,a as te,x as ne,ai as re,F as de,G as A,H as E,aj as se,ak as ue,al as pe}from"./index-PFvgZIwd.js";import{b as u}from"./validate-BsCjhJOi.js";import{c as O}from"./index-WCJCg2j1.js";import"./index-B3GXhXFg.js";import"./index-JTTiPgQY.js";const ce={};function fe(G,U){return p(),S("div")}const me=j(ce,[["render",fe]]),ge={class:"user-views"},be={class:"card-header"},ye={class:"user-profile"},ve={key:0},we={key:1},Ve={style:"width: calc(100% - 20px)"},he={style:"width: calc(100% - 20px)"},Ce=Y({__name:"profile",setup(G){let U;const{t:a}=le.useI18n(),W=x(),b=ie(),H=te(),V=I(),h=I(),C=I(),e=ee({formSubmitLoading:!1,form:b.$state,rules:{username:[u({name:"required",title:a("user.account.profile.User name")}),u({name:"account"})],nickname:[u({name:"required",title:a("user.account.profile.nickname")})]},accountVerificationType:[],dialog:{type:"email",submitLoading:!1,sendCaptchaLoading:!1,codeSendCountdown:0,captchaId:ne(),verification:{show:!1,rules:{password:[u({name:"required",title:a("user.account.profile.password")}),u({name:"password"})],captcha:[u({name:"required",title:a("user.account.profile.Verification Code")})]},form:{password:"",captcha:""},accountVerificationToken:""},bind:{show:!1,rules:{password:[u({name:"required",title:a("user.account.profile.password")}),u({name:"password"})],email:[u({name:"required",title:a("user.account.profile.email")}),u({name:"email",title:a("user.account.profile.email")})],mobile:[u({name:"required",title:a("user.account.profile.mobile")}),u({name:"mobile",title:a("user.account.profile.mobile")})],captcha:[u({name:"required",title:a("user.account.profile.Verification Code")})]},form:{password:"",email:"",mobile:"",captcha:""}}}}),B=l=>{e.dialog.codeSendCountdown=l,U=window.setInterval(()=>{e.dialog.codeSendCountdown--,e.dialog.codeSendCountdown<=0&&L()},1e3)},L=()=>{e.dialog.codeSendCountdown=0,clearInterval(U)},M=l=>{l=="email"&&b.email||l=="mobile"&&b.mobile?e.dialog.verification.show=!0:e.dialog.bind.show=!0,e.dialog.type=l},Z=()=>{e.dialog.codeSendCountdown>0||C.value.validateField("password").then(l=>{l&&O(e.dialog.captchaId,o=>z(o))})},z=l=>{e.dialog.sendCaptchaLoading=!0,(e.dialog.type=="email"?A:E)(b[e.dialog.type],`user_${e.dialog.type}_verify`,{password:e.dialog.verification.form.password,captchaId:e.dialog.captchaId,captchaInfo:l}).then(s=>{s.code==1&&B(60)}).finally(()=>{e.dialog.sendCaptchaLoading=!1})},J=()=>{e.dialog.codeSendCountdown>0||h.value.validateField(e.dialog.type).then(l=>{l&&O(e.dialog.captchaId,o=>Q(o))})},Q=l=>{e.dialog.sendCaptchaLoading=!0,(e.dialog.type=="email"?A:E)(e.dialog.bind.form[e.dialog.type],`user_change_${e.dialog.type}`,{captchaId:e.dialog.captchaId,captchaInfo:l}).then(s=>{s.code==1&&B(60)}).finally(()=>{e.dialog.sendCaptchaLoading=!1})},N=()=>{C.value&&C.value.validate(l=>{l&&(e.dialog.submitLoading=!0,se({type:e.dialog.type,captcha:e.dialog.verification.form.captcha}).then(o=>{L(),e.dialog.bind.show=!0,e.dialog.type=o.data.type,e.dialog.verification.show=!1,e.dialog.verification.accountVerificationToken=o.data.accountVerificationToken}).finally(()=>{e.dialog.submitLoading=!1}))})},R=()=>{h.value&&h.value.validate(l=>{l&&(e.dialog.submitLoading=!0,ue({type:e.dialog.type,accountVerificationToken:e.dialog.verification.accountVerificationToken,...e.dialog.bind.form}).then(()=>{L(),e.dialog.bind.show=!1,b[e.dialog.type]=e.dialog.bind.form[e.dialog.type]}).finally(()=>{e.dialog.submitLoading=!1}))})},q=()=>{V.value&&V.value.validate(l=>{l&&(e.formSubmitLoading=!0,pe(e.form).then(()=>{e.formSubmitLoading=!1}).catch(()=>{e.formSubmitLoading=!1}))})};return oe(()=>{re().then(l=>{e.accountVerificationType=l.data.accountVerificationType})}),(l,o)=>{const s=m("el-button"),k=m("el-input"),y=m("el-form-item"),P=m("el-form"),X=m("el-card"),$=m("el-col"),D=m("el-row"),K=m("el-dialog"),_=ae("blur");return p(),S("div",ge,[n(X,{class:"user-views-card",shadow:"hover"},{header:r(()=>[v("div",be,[v("span",null,d(l.$t("user.account.profile.personal data")),1),T((p(),g(s,{onClick:o[0]||(o[0]=i=>t(W).push({name:"account/changePassword"})),type:"info",plain:""},{default:r(()=>[c(d(l.$t("user.account.profile.Change Password")),1)]),_:1})),[[_]])])]),default:r(()=>[v("div",ye,[n(P,{"label-position":t(H).state.shrink?"top":"right",model:e.form,rules:e.rules,"label-width":100,ref_key:"formRef",ref:V,onKeyup:o[13]||(o[13]=F(i=>q(),["enter"]))},{default:r(()=>[n(f,{label:l.$t("user.account.profile.head portrait"),"input-attr":{hideSelectFile:!0},type:"image",modelValue:e.form.avatar,"onUpdate:modelValue":o[1]||(o[1]=i=>e.form.avatar=i),prop:"avatar"},null,8,["label","modelValue"]),n(f,{label:l.$t("user.account.profile.User name"),type:"string",modelValue:e.form.username,"onUpdate:modelValue":o[2]||(o[2]=i=>e.form.username=i),placeholder:l.$t("Please input field",{field:l.$t("user.account.profile.User name")}),prop:"username"},null,8,["label","modelValue","placeholder"]),n(f,{label:l.$t("user.account.profile.User nickname"),type:"string",modelValue:e.form.nickname,"onUpdate:modelValue":o[3]||(o[3]=i=>e.form.nickname=i),placeholder:l.$t("Please input field",{field:l.$t("user.account.profile.User nickname")}),prop:"nickname"},null,8,["label","modelValue","placeholder"]),e.accountVerificationType.includes("email")?(p(),g(y,{key:0,label:t(a)("user.account.profile.email")},{default:r(()=>[n(k,{modelValue:e.form.email,"onUpdate:modelValue":o[5]||(o[5]=i=>e.form.email=i),readonly:"",placeholder:t(a)("user.account.profile.Operation via right button")},{append:r(()=>[n(s,{type:"primary",onClick:o[4]||(o[4]=i=>M("email"))},{default:r(()=>[c(d(e.form.email?t(a)("user.account.profile.Click Modify"):t(a)("user.account.profile.bind")),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),e.accountVerificationType.includes("mobile")?(p(),g(y,{key:1,label:t(a)("user.account.profile.mobile")},{default:r(()=>[n(k,{modelValue:e.form.mobile,"onUpdate:modelValue":o[7]||(o[7]=i=>e.form.mobile=i),readonly:"",placeholder:t(a)("user.account.profile.Operation via right button")},{append:r(()=>[n(s,{type:"primary",onClick:o[6]||(o[6]=i=>M("mobile"))},{default:r(()=>[c(d(e.form.mobile?t(a)("user.account.profile.Click Modify"):t(a)("user.account.profile.bind")),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),n(f,{label:l.$t("user.account.profile.Gender"),type:"radio",modelValue:e.form.gender,"onUpdate:modelValue":o[8]||(o[8]=i=>e.form.gender=i),"input-attr":{border:!0,content:{0:l.$t("user.account.profile.secrecy"),1:l.$t("user.account.profile.male"),2:l.$t("user.account.profile.female")}}},null,8,["label","modelValue","input-attr"]),n(f,{label:l.$t("user.account.profile.birthday"),type:"date",modelValue:e.form.birthday,"onUpdate:modelValue":o[9]||(o[9]=i=>e.form.birthday=i)},null,8,["label","modelValue"]),n(f,{label:l.$t("user.account.profile.Personal signature"),type:"textarea",placeholder:l.$t("Please input field",{field:l.$t("user.account.profile.Personal signature")}),modelValue:e.form.motto,"onUpdate:modelValue":o[10]||(o[10]=i=>e.form.motto=i),"input-attr":{showWordLimit:!0,maxlength:120,rows:3}},null,8,["label","placeholder","modelValue"]),n(me),n(y,{class:"submit-buttons"},{default:r(()=>[n(s,{onClick:o[11]||(o[11]=i=>t(de)(V.value))},{default:r(()=>[c(d(l.$t("Reset")),1)]),_:1}),n(s,{type:"primary",loading:e.formSubmitLoading,onClick:o[12]||(o[12]=i=>q())},{default:r(()=>[c(d(l.$t("Save")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["label-position","model","rules"])])]),_:1}),n(K,{title:t(a)("user.account.profile.Account verification"),modelValue:e.dialog.verification.show,"onUpdate:modelValue":o[19]||(o[19]=i=>e.dialog.verification.show=i),class:"ba-change-bind-dialog ba-verification-dialog","destroy-on-close":!0,"close-on-click-modal":!1,width:"30%"},{footer:r(()=>[v("div",Ve,[n(s,{onClick:o[17]||(o[17]=i=>e.dialog.verification.show=!1)},{default:r(()=>[c(d(t(a)("Cancel")),1)]),_:1}),T((p(),g(s,{loading:e.dialog.submitLoading,onClick:o[18]||(o[18]=i=>N()),type:"primary"},{default:r(()=>[c(d(t(a)("user.account.profile.next step")),1)]),_:1},8,["loading"])),[[_]])])]),default:r(()=>[n(P,{model:e.dialog.verification.form,rules:e.dialog.verification.rules,"label-position":"top",ref_key:"verificationFormRef",ref:C,onKeyup:o[16]||(o[16]=F(i=>N(),["enter"]))},{default:r(()=>[n(f,{label:t(a)("user.account.profile.Account password verification"),type:"password",modelValue:e.dialog.verification.form.password,"onUpdate:modelValue":o[14]||(o[14]=i=>e.dialog.verification.form.password=i),prop:"password","input-attr":{showPassword:!0},placeholder:l.$t("Please input field",{field:l.$t("user.account.profile.password")})},null,8,["label","modelValue","placeholder"]),n(y,{prop:"captcha"},{label:r(()=>[e.dialog.type=="email"?(p(),S("span",ve,d(t(a)("user.account.profile.Mail verification"))+" ("+d(t(a)("user.account.profile.accept")+t(a)("user.account.profile.mail")+"："+t(b).email)+") ",1)):(p(),S("span",we,d(t(a)("user.account.profile.SMS verification"))+" ("+d(t(a)("user.account.profile.accept")+t(a)("user.account.profile.mobile")+"："+t(b).mobile)+") ",1))]),default:r(()=>[n(D,{class:"w100",gutter:10},{default:r(()=>[n($,{span:18},{default:r(()=>[n(k,{modelValue:e.dialog.verification.form.captcha,"onUpdate:modelValue":o[15]||(o[15]=i=>e.dialog.verification.form.captcha=i),placeholder:t(a)("Please input field",{field:t(a)("user.account.profile.Verification Code")}),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1}),n($,{class:"captcha-box",span:6},{default:r(()=>[n(s,{onClick:Z,loading:e.dialog.sendCaptchaLoading,disabled:!(e.dialog.codeSendCountdown<=0),type:"primary"},{default:r(()=>[c(d(e.dialog.codeSendCountdown<=0?t(a)("user.account.profile.send"):e.dialog.codeSendCountdown+t(a)("user.account.profile.seconds")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),n(K,{title:t(a)("user.account.profile.bind")+t(a)("user.account.profile."+e.dialog.type),modelValue:e.dialog.bind.show,"onUpdate:modelValue":o[27]||(o[27]=i=>e.dialog.bind.show=i),class:"ba-change-bind-dialog ba-bind-dialog","destroy-on-close":!0,"close-on-click-modal":!1,width:"30%"},{footer:r(()=>[v("div",he,[n(s,{onClick:o[25]||(o[25]=i=>e.dialog.bind.show=!1)},{default:r(()=>[c(d(t(a)("Cancel")),1)]),_:1}),T((p(),g(s,{loading:e.dialog.submitLoading,onClick:o[26]||(o[26]=i=>R()),type:"primary"},{default:r(()=>[c(d(t(a)("user.account.profile.bind")),1)]),_:1},8,["loading"])),[[_]])])]),default:r(()=>[n(P,{model:e.dialog.bind.form,rules:e.dialog.bind.rules,"label-position":"top",ref_key:"bindFormRef",ref:h,onKeyup:o[24]||(o[24]=F(i=>R(),["enter"]))},{default:r(()=>[e.dialog.verification.accountVerificationToken?w("",!0):(p(),g(f,{key:0,label:t(a)("user.account.profile.Account password verification"),type:"password",modelValue:e.dialog.bind.form.password,"onUpdate:modelValue":o[20]||(o[20]=i=>e.dialog.bind.form.password=i),prop:"password","input-attr":{showPassword:!0},placeholder:l.$t("Please input field",{field:l.$t("user.account.profile.password")})},null,8,["label","modelValue","placeholder"])),e.dialog.type=="email"?(p(),g(f,{key:1,label:t(a)("user.account.profile.New "+e.dialog.type),type:"string",modelValue:e.dialog.bind.form.email,"onUpdate:modelValue":o[21]||(o[21]=i=>e.dialog.bind.form.email=i),prop:"email",placeholder:l.$t("Please input field",{field:t(a)("user.account.profile.New "+e.dialog.type)})},null,8,["label","modelValue","placeholder"])):w("",!0),e.dialog.type=="mobile"?(p(),g(f,{key:2,label:t(a)("user.account.profile.New "+e.dialog.type),type:"string",modelValue:e.dialog.bind.form.mobile,"onUpdate:modelValue":o[22]||(o[22]=i=>e.dialog.bind.form.mobile=i),prop:"mobile",placeholder:l.$t("Please input field",{field:t(a)("user.account.profile.New "+e.dialog.type)})},null,8,["label","modelValue","placeholder"])):w("",!0),n(y,{label:e.dialog.type=="email"?t(a)("user.account.profile.Mail verification"):t(a)("user.account.profile.SMS verification"),prop:"captcha"},{default:r(()=>[n(D,{class:"w100",gutter:10},{default:r(()=>[n($,{span:18},{default:r(()=>[n(k,{modelValue:e.dialog.bind.form.captcha,"onUpdate:modelValue":o[23]||(o[23]=i=>e.dialog.bind.form.captcha=i),placeholder:t(a)("Please input field",{field:t(a)("user.account.profile.Verification Code")}),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1}),n($,{class:"captcha-box",span:6},{default:r(()=>[n(s,{onClick:J,loading:e.dialog.sendCaptchaLoading,disabled:!(e.dialog.codeSendCountdown<=0),type:"primary"},{default:r(()=>[c(d(e.dialog.codeSendCountdown<=0?t(a)("user.account.profile.send"):e.dialog.codeSendCountdown+t(a)("user.account.profile.seconds")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}}),Ie=j(Ce,[["__scopeId","data-v-60c21672"]]);export{Ie as default};
